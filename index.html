<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Growth Tracker</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .tab-btn { @apply py-4 px-1 border-b-2 border-transparent text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300; }
        .tab-btn.active { @apply border-indigo-500 text-indigo-600; }
        .form-label { @apply block text-sm font-medium text-gray-700 mb-1; }
        .form-input { @apply mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500; }
        #loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .admin-tab { display: none; }
        th.sortable { cursor: pointer; user-select: none; }
        th.sortable:hover { background-color: #f9fafb; }
        .sort-icon { display: inline-block; margin-left: 5px; opacity: 0.4; transition: opacity 0.2s, transform 0.2s; }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <div id="loader"></div>
    <div id="app" class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 hidden">
        <!-- HEADER -->
        <header class="flex justify-between items-center mb-6">
            <div>
                <h1 class="text-3xl font-bold text-gray-800">Growth Tracker</h1>
                <p class="text-gray-500">Your central hub for productivity and performance.</p>
            </div>
            <div class="text-right">
                <p class="text-sm text-gray-600">Welcome,</p>
                <p id="currentUser" class="font-semibold text-lg text-indigo-600">Loading...</p>
            </div>
        </header>

        <!-- TABS -->
        <div class="mb-6">
            <div class="border-b border-gray-200">
                <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                    <button class="tab-btn active" data-tab="tab-daily">Clock In / Out</button>
                    <button class="tab-btn" data-tab="tab-presentation">Log Presentation</button>
                    <button class="tab-btn" data-tab="tab-dashboard">Dashboard</button>
                    <button class="tab-btn" data-tab="tab-goals">My Goals</button>
                    <button class="tab-btn" data-tab="tab-teamview">Team View</button>
                    <button class="tab-btn admin-tab" data-tab="tab-admin">Admin</button>
                </nav>
            </div>
        </div>
        
        <!-- CONTENT -->
        <main>
            <!-- Clock In/Out Tab -->
            <div id="tab-daily" class="tab-content">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-semibold mb-4 border-b pb-2">Time Clock</h2>
                        <div class="flex space-x-4">
                            <button id="clockInBtn" class="flex-1 bg-green-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-600 transition">Clock In</button>
                            <button id="clockOutBtn" class="flex-1 bg-red-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-red-600 transition">Clock Out</button>
                        </div>
                        <p id="clockStatus" class="mt-4 text-center text-gray-600"></p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-semibold mb-4 border-b pb-2">Log Daily Totals</h2>
                        <form id="dailyMetricsForm">
                            <div class="grid grid-cols-2 gap-4">
                                <div><label for="metricsDate" class="form-label">Date</label><input type="date" id="metricsDate" required class="form-input"></div>
                                <div><label for="dials" class="form-label">Total Dials</label><input type="number" id="dials" required class="form-input"></div>
                                <div><label for="presentations" class="form-label">Presentations</label><input type="number" id="presentations" required class="form-input"></div>
                                <div><label for="binds" class="form-label">Total Binds</label><input type="number" id="binds" required class="form-input"></div>
                                <div class="col-span-2"><label for="alp" class="form-label">Total ALP</label><input type="number" step="0.01" id="alp" required class="form-input"></div>
                            </div>
                            <div class="text-right mt-6"><button type="submit" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition">Submit</button></div>
                            <p id="metricsStatus" class="mt-4 text-center text-gray-600"></p>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Log Presentation Tab -->
            <div id="tab-presentation" class="tab-content hidden">
                <div class="bg-white p-8 rounded-lg shadow-md">
                    <h2 class="text-2xl font-bold mb-6 text-gray-800 border-b pb-4">Presentation & Client Details</h2>
                    <form id="presentationForm">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <!-- Column 1 -->
                            <div class="space-y-4">
                                <div><label for="p-clientName" class="form-label">Client Name</label><input type="text" id="p-clientName" class="form-input" required></div>
                                <div><label for="p-date" class="form-label">Date</label><input type="date" id="p-date" class="form-input" required></div>
                                <div><label for="p-policyStatus" class="form-label">Policy Status</label><select id="p-policyStatus" class="form-input"><option>PENDING</option><option>POLICY ISSUED</option><option>NOPRD or INV</option><option>DECLINE</option><option>CANCELLED</option><option>THINK</option><option>NO - not interested</option></select></div>
                                <div><label for="p-alp" class="form-label">ALP</label><input type="number" step="0.01" id="p-alp" class="form-input"></div>
                                <div><label for="p-policyNumber" class="form-label">Policy Number</label><input type="text" id="p-policyNumber" class="form-input"></div>
                                <div><label for="p-sponsor" class="form-label">Sponsor</label><input type="text" id="p-sponsor" class="form-input"></div>
                            </div>
                            <!-- Column 2 -->
                            <div class="space-y-4">
                                <div><label for="p-phoneNumber" class="form-label">Phone Number</label><input type="tel" id="p-phoneNumber" class="form-input"></div>
                                <div><label for="p-email" class="form-label">Email</label><input type="email" id="p-email" class="form-input"></div>
                                <div><label for="p-job" class="form-label">Job</label><input type="text" id="p-job" class="form-input"></div>
                                <div><label for="p-beneficiary" class="form-label">Beneficiary</label><input type="text" id="p-beneficiary" class="form-input"></div>
                                <div><label for="p-executor" class="form-label">Executor</label><input type="text" id="p-executor" class="form-input"></div>
                                <div><label for="p-kids" class="form-label">Kids</label><input type="text" id="p-kids" class="form-input"></div>
                            </div>
                            <!-- Column 3 -->
                            <div class="space-y-4">
                                <div><label for="p-healthConditions" class="form-label">Health Conditions</label><input type="text" id="p-healthConditions" class="form-input"></div>
                                <div><label for="p-plusLeads" class="form-label">Plus Leads</label><input type="text" id="p-plusLeads" class="form-input"></div>
                                <div><label for="p-domino" class="form-label">Domino?</label><input type="text" id="p-domino" class="form-input"></div>
                                <div><label for="p-nextAppointment" class="form-label">Next Appointment</label><input type="datetime-local" id="p-nextAppointment" class="form-input"></div>
                                <div><label for="p-reasonForCoverage" class="form-label">Reason For Coverage/Not</label><textarea id="p-reasonForCoverage" class="form-input" rows="3"></textarea></div>
                            </div>
                        </div>
                        <div class="mt-6"><label for="p-notes" class="form-label">General Notes</label><textarea id="p-notes" class="form-input w-full" rows="4"></textarea></div>
                        <div class="mt-8 text-right"><button type="submit" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-indigo-700 transition">Log Presentation</button></div>
                        <p id="presentationStatus" class="mt-4 text-center text-gray-600"></p>
                    </form>
                </div>
            </div>

            <!-- Dashboard Tab -->
            <div id="tab-dashboard" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2 bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-medium mb-4">This Week: Your Performance vs. Team Average</h3>
                        <canvas id="performanceChart"></canvas>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-medium mb-4">Weekly Top Performers (by ALP)</h3>
                        <div id="leaderboard" class="space-y-4"></div>
                    </div>
                </div>
            </div>
            
            <!-- Goals Tab -->
            <div id="tab-goals" class="tab-content hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-semibold mb-4 border-b pb-2">Set Your Monthly Goals</h2>
                        <form id="goalsForm" class="space-y-4">
                            <div><label for="g-dials" class="form-label">Monthly Dials Goal</label><input type="number" id="g-dials" class="form-input"></div>
                            <div><label for="g-presentations" class="form-label">Presentations Goal</label><input type="number" id="g-presentations" class="form-input"></div>
                            <div><label for="g-binds" class="form-label">Monthly Binds Goal</label><input type="number" id="g-binds" class="form-input"></div>
                            <div><label for="g-alp" class="form-label">Monthly ALP Goal</label><input type="number" step="0.01" id="g-alp" class="form-input"></div>
                            <div class="text-right"><button type="submit" class="bg-green-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-green-700 transition">Save Goals</button></div>
                            <p id="goalStatus" class="mt-4 text-center text-gray-600"></p>
                        </form>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-semibold mb-4 border-b pb-2">This Month's Progress</h2>
                        <div id="goalProgress" class="space-y-6 pt-2"></div>
                    </div>
                </div>
            </div>

            <!-- Team View Tab -->
            <div id="tab-teamview" class="tab-content hidden">
                <div class="bg-white p-6 rounded-lg shadow-md">
                   <h2 class="text-xl font-semibold mb-4 border-b pb-2">This Week's Team Performance</h2>
                    <div class="overflow-x-auto">
                       <table class="min-w-full divide-y divide-gray-200">
                           <thead class="bg-gray-50">
                               <tr>
                                   <th class="sortable px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-sort="name">Name <span class="sort-icon"></span></th>
                                   <th class="sortable px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-sort="dials">Dials <span class="sort-icon"></span></th>
                                   <th class="sortable px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-sort="presentations">Pres. <span class="sort-icon"></span></th>
                                   <th class="sortable px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-sort="binds">Binds <span class="sort-icon"></span></th>
                                   <th class="sortable px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider" data-sort="alp">ALP <span class="sort-icon"></span></th>
                               </tr>
                           </thead>
                           <tbody id="teamViewTable" class="bg-white divide-y divide-gray-200">
                               <!-- Team data will be populated here -->
                           </tbody>
                       </table>
                   </div>
               </div>
            </div>
            
            <!-- ADMIN Tab -->
            <div id="tab-admin" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Manage Staff -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h2 class="text-xl font-semibold mb-4 border-b pb-2">Manage Staff</h2>
                        <form id="addStaffForm" class="space-y-4 mb-6">
                           <div><label for="staffName" class="form-label">Full Name</label><input type="text" id="staffName" class="form-input" required></div>
                           <div><label for="staffEmail" class="form-label">Email Address</label><input type="email" id="staffEmail" class="form-input" required></div>
                           <div><label for="staffRole" class="form-label">Role</label><select id="staffRole" class="form-input"><option>Staff</option><option>Admin</option></select></div>
                           <div class="text-right"><button type="submit" class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition">Add Staff</button></div>
                           <p id="addStaffStatus" class="mt-4 text-center text-gray-600"></p>
                        </form>
                        
                        <h3 class="text-lg font-medium mb-4">Current Staff Roster</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50"><tr><th class="th">Name</th><th class="th">Email</th><th class="th">Role</th></tr></thead>
                                <tbody id="staffListTable" class="bg-white divide-y divide-gray-200"></tbody>
                            </table>
                        </div>
                    </div>
                    <!-- Team Performance (Admin) -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                         <h2 class="text-xl font-semibold mb-4 border-b pb-2">This Week's Detailed Team Performance</h2>
                         <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50"><tr><th class="th">Name</th><th class="th">Dials</th><th class="th">Pres.</th><th class="th">Binds</th><th class="th">ALP</th></tr></thead>
                                <tbody id="adminDashboardTable" class="bg-white divide-y divide-gray-200"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyMfgMA8-WPDjy4GFIKwlDG9Czp_as87-ri1oAkZFUYJ_qWzF0sXJt1Rz9FWq8BNOTflQ/exec';
        let performanceChart = null;
        let teamViewData = [];
        let currentSort = { key: 'alp', order: 'desc' };

        // --- API CALLER ---
        async function callApi(action, payload = {}, method = 'POST') {
            document.getElementById('loader').style.display = 'block';
            try {
                const url = new URL(APPS_SCRIPT_URL);
                let response;
                if (method === 'GET') {
                    url.searchParams.append('action', action);
                    response = await fetch(url, { redirect: 'follow' });
                } else {
                    response = await fetch(url, { method: 'POST', mode: 'cors', body: JSON.stringify({ action, payload }) });
                }
                const result = await response.json();
                if (!result.success) throw new Error(result.message || 'API call failed');
                return result;
            } catch (error) {
                console.error(`API Error (${action}):`, error);
                alert(`Error: ${error.message}`);
                throw error;
            } finally {
                document.getElementById('loader').style.display = 'none';
            }
        }
        
        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            if (APPS_SCRIPT_URL.includes('PASTE_YOUR')) {
                alert("CRITICAL: Edit index.html and paste your Apps Script URL.");
                document.getElementById('loader').style.display = 'none';
                return;
            }
            initializeApp();
        });

        async function initializeApp() {
            try {
                const { data: user } = await callApi('getUserInfo', {}, 'GET');
                document.getElementById('currentUser').textContent = user.name;
                
                if (user.isAdmin) {
                    document.querySelector('.admin-tab').style.display = 'block';
                    loadAdminData();
                }
                
                setupEventListeners();
                setupTabNavigation();
                await Promise.all([updateDashboard(), updateGoals(), loadTeamViewData()]);
                document.getElementById('app').classList.remove('hidden');

            } catch (error) {
                document.getElementById('currentUser').textContent = "Authorization Error";
                alert("Could not load user data. You may need to visit the Apps Script URL in your browser once to authorize the script.");
            }
        }
        
        function setupTabNavigation() {
            document.querySelectorAll('.tab-btn').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    document.querySelectorAll('.tab-btn').forEach(t => t.classList.remove('active'));
                    e.target.classList.add('active');
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
                    document.getElementById(e.target.dataset.tab).classList.remove('hidden');
                });
            });
        }
        
        function setupEventListeners() {
            document.getElementById("clockInBtn").addEventListener("click", () => handleClockEvent("Clock In"));
            document.getElementById("clockOutBtn").addEventListener("click", () => handleClockEvent("Clock Out"));
            document.getElementById("dailyMetricsForm").addEventListener("submit", handleDailyMetrics);
            document.getElementById("presentationForm").addEventListener("submit", handlePresentation);
            document.getElementById("goalsForm").addEventListener("submit", handleSetGoal);
            document.getElementById("addStaffForm").addEventListener("submit", handleAddStaff);
            document.querySelectorAll('#teamViewTable th.sortable').forEach(th => th.addEventListener('click', () => {
                const sortKey = th.dataset.sort;
                const order = (currentSort.key === sortKey && currentSort.order === 'asc') ? 'desc' : 'asc';
                currentSort = { key: sortKey, order };
                renderTeamViewTable();
            }));
        }

        // --- EVENT HANDLERS ---
        async function handleClockEvent(eventType) {
            const statusEl = document.getElementById("clockStatus");
            statusEl.textContent = `Logging ${eventType}...`;
            try {
                const result = await callApi('logClockEvent', { eventType });
                statusEl.textContent = result.message;
            } catch (error) { statusEl.textContent = `Error: ${error.message}`; }
            setTimeout(() => statusEl.textContent = '', 3000);
        }

        async function handleDailyMetrics(e) {
            e.preventDefault();
            const statusEl = document.getElementById("metricsStatus");
            statusEl.textContent = "Submitting...";
            try {
                const payload = {
                    dateOfMetrics: document.getElementById('metricsDate').value,
                    dials: document.getElementById('dials').value,
                    presentations: document.getElementById('presentations').value,
                    binds: document.getElementById('binds').value,
                    alp: document.getElementById('alp').value,
                };
                const result = await callApi('logDailyMetrics', payload);
                statusEl.textContent = result.message;
                e.target.reset();
                Promise.all([updateDashboard(), updateGoals(), loadTeamViewData()]); 
            } catch (error) { statusEl.textContent = `Error: ${error.message}`; }
        }

        async function handlePresentation(e) {
            e.preventDefault();
            const statusEl = document.getElementById("presentationStatus");
            statusEl.textContent = "Logging presentation...";
            try {
                const payload = Array.from(e.target.elements).reduce((acc, el) => {
                    if (el.id) acc[el.id.replace('p-', '')] = el.value;
                    return acc;
                }, {});
                const result = await callApi('logPresentation', payload);
                statusEl.textContent = result.message;
                e.target.reset();
            } catch(error) { statusEl.textContent = `Error: ${error.message}`; }
        }

        async function handleSetGoal(e) {
            e.preventDefault();
            const statusEl = document.getElementById("goalStatus");
            statusEl.textContent = "Saving goals...";
            try {
                const payload = {
                    dials: document.getElementById('g-dials').value,
                    presentations: document.getElementById('g-presentations').value,
                    binds: document.getElementById('g-binds').value,
                    alp: document.getElementById('g-alp').value,
                };
                const result = await callApi('setGoal', payload);
                statusEl.textContent = result.message;
                updateGoals();
            } catch(error) { statusEl.textContent = `Error: ${error.message}`; }
        }
        
        async function handleAddStaff(e) {
            e.preventDefault();
            const statusEl = document.getElementById('addStaffStatus');
            statusEl.textContent = "Adding staff...";
            try {
                const payload = {
                    name: document.getElementById('staffName').value,
                    email: document.getElementById('staffEmail').value,
                    role: document.getElementById('staffRole').value,
                };
                const result = await callApi('addStaffMember', payload);
                statusEl.textContent = result.message;
                e.target.reset();
                loadAdminData();
            } catch(error) { statusEl.textContent = `Error: ${error.message}`; }
        }

        // --- UI RENDERERS ---
        async function updateDashboard() {
            try {
                const { data } = await callApi('getDashboardData', {}, 'GET');
                const ctx = document.getElementById('performanceChart').getContext('2d');
                if (performanceChart) performanceChart.destroy();
                performanceChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Dials', 'Presentations', 'Binds', 'ALP'],
                        datasets: [
                            { label: 'Your Performance', data: [data.personal.dials, data.personal.presentations, data.personal.binds, data.personal.alp], backgroundColor: 'rgba(59, 130, 246, 0.5)', borderColor: 'rgba(59, 130, 246, 1)', borderWidth: 1 },
                            { label: 'Team Average', data: [data.team.dials, data.team.presentations, data.team.binds, data.team.alp], backgroundColor: 'rgba(209, 213, 219, 0.5)', borderColor: 'rgba(107, 114, 128, 1)', borderWidth: 1 }
                        ]
                    }
                });
                const leaderboardEl = document.getElementById('leaderboard');
                leaderboardEl.innerHTML = data.leaderboard.length ? data.leaderboard.map((p, i) => `
                    <div class="flex items-center justify-between"><span class="font-medium">${i + 1}. ${p.name}</span><span class="text-gray-600 font-semibold">$${p.alp.toFixed(2)}</span></div>`).join('') 
                    : '<p class="text-gray-500">No data for this week yet.</p>';
            } catch (error) { /* Handled by callApi */ }
        }

        async function updateGoals() {
            try {
                const { data } = await callApi('getGoals', {}, 'GET');
                ['dials', 'presentations', 'binds', 'alp'].forEach(k => document.getElementById(`g-${k}`).value = data.goals[k]);
                
                document.getElementById('goalProgress').innerHTML = Object.keys(data.goals).map(key => {
                    const goal = data.goals[key] || 0;
                    const progress = data.progress[key] || 0;
                    const percent = goal > 0 ? Math.min(100, Math.round((progress / goal) * 100)) : 0;
                    const isCurrency = key === 'alp';
                    return `<div>
                        <div class="flex justify-between mb-1"><span class="text-base font-medium text-gray-700 capitalize">${key}</span><span class="text-sm font-medium text-gray-700">${isCurrency ? '$' : ''}${progress.toFixed(isCurrency ? 2:0)} / ${isCurrency ? '$' : ''}${goal}</span></div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-blue-600 h-2.5 rounded-full" style="width: ${percent}%"></div></div>
                    </div>`;
                }).join('');
            } catch (error) { /* Handled by callApi */ }
        }

        async function loadTeamViewData() {
            try {
                const { data } = await callApi('getTeamViewData', {}, 'GET');
                teamViewData = data;
                renderTeamViewTable();
            } catch (error) { /* Handled by callApi */ }
        }
        
        function renderTeamViewTable() {
            const sortedData = [...teamViewData].sort((a, b) => {
                const aVal = typeof a[currentSort.key] === 'string' ? a[currentSort.key].toLowerCase() : a[currentSort.key];
                const bVal = typeof b[currentSort.key] === 'string' ? b[currentSort.key].toLowerCase() : b[currentSort.key];
                if (aVal < bVal) return currentSort.order === 'asc' ? -1 : 1;
                if (aVal > bVal) return currentSort.order === 'asc' ? 1 : -1;
                return 0;
            });

            document.getElementById('teamViewTable').innerHTML = sortedData.map(perf => `
                <tr class="text-sm">
                    <td class="px-4 py-4 font-medium text-gray-900">${perf.name}</td>
                    <td class="px-4 py-4 text-gray-500">${perf.dials}</td>
                    <td class="px-4 py-4 text-gray-500">${perf.presentations}</td>
                    <td class="px-4 py-4 text-gray-500">${perf.binds}</td>
                    <td class="px-4 py-4 font-semibold text-gray-700">$${perf.alp.toFixed(2)}</td>
                </tr>
            `).join('');

            document.querySelectorAll('#teamViewTable th.sortable .sort-icon').forEach(icon => icon.innerHTML = '');
            const activeTh = document.querySelector(`#teamViewTable th[data-sort="${currentSort.key}"] .sort-icon`);
            if (activeTh) activeTh.innerHTML = currentSort.order === 'asc' ? '▲' : '▼';
        }

        async function loadAdminData() {
            try {
                const [{ data: staffList }, { data: adminDashData }] = await Promise.all([
                    callApi('getStaffList', {}, 'GET'),
                    callApi('getAdminDashboardData', {}, 'GET')
                ]);

                document.getElementById('staffListTable').innerHTML = staffList.map(staff => `
                    <tr><td class="td">${staff.Name}</td><td class="td">${staff.Email}</td><td class="td">${staff.Role}</td></tr>`).join('');
                document.getElementById('adminDashboardTable').innerHTML = adminDashData.map(perf => `
                    <tr class="text-sm"><td class="td">${perf.name}</td><td class="td">${perf.dials}</td><td class="td">${perf.presentations}</td><td class="td">${perf.binds}</td><td class="td font-semibold">$${perf.alp.toFixed(2)}</td></tr>`).join('');
            } catch (error) { /* Handled by callApi */ }
        }
    </script>
</body>
</html>
